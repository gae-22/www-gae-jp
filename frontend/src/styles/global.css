@import 'tailwindcss';
@plugin "@tailwindcss/typography";

@font-face {
    font-family: 'PleckJP';
    src: url('/fonts/pleckjp/PleckJP-Regular.woff2') format('woff2');
    font-weight: 400;
    font-style: normal;
    font-display: swap;
}

@font-face {
    font-family: 'PleckJP';
    src: url('/fonts/pleckjp/PleckJP-Bold.woff2') format('woff2');
    font-weight: 700;
    font-style: normal;
    font-display: swap;
}

@font-face {
    font-family: 'PleckJP';
    src: url('/fonts/pleckjp/PleckJP-Italic.woff2') format('woff2');
    font-weight: 400;
    font-style: italic;
    font-display: swap;
}

@font-face {
    font-family: 'PleckJP';
    src: url('/fonts/pleckjp/PleckJP-BoldItalic.woff2') format('woff2');
    font-weight: 700;
    font-style: italic;
    font-display: swap;
}

@theme {
    /* Digital Craftsmanship Grid Palette */
    --color-deep: #09090b; /* Zinc 950 */
    --color-paper: #f4f4f5; /* Zinc 100 - Darker background to make cards pop */
    --color-ink: #18181b; /* Zinc 900 */
    --color-ink-muted: #52525b; /* Zinc 600 */

    /* Accents - "Editorial Studio" */
    --color-accent-indigo: #4338ca; /* Indigo 700 - Deep, professional */
    --color-accent-teal: #0f766e; /* Teal 700 - Trusted, calm */
    --color-accent-highlight: #f59e0b; /* Amber 500 - Subtle warmth for tiny details */

    /* Typography */
    --font-display: 'Outfit', 'Zen Kaku Gothic New', sans-serif;
    --font-body: 'Zen Kaku Gothic New', 'Inter', sans-serif;
    --font-mono: 'JetBrains Mono', monospace;

    /* Animation Config */
    --animate-fade-in: fade-in 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    --animate-slide-up: slide-up 1s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    --animate-float: float 8s ease-in-out infinite;
    --animate-grain: grain 8s steps(10) infinite;

    @keyframes fade-in {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
    @keyframes slide-up {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    @keyframes float {
        0%,
        100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-8px);
        }
    }
    @keyframes grain {
        0%,
        100% {
            transform: translate(0, 0);
        }
        10% {
            transform: translate(-5%, -10%);
        }
        20% {
            transform: translate(-15%, 5%);
        }
        30% {
            transform: translate(7%, -25%);
        }
        40% {
            transform: translate(-5%, 25%);
        }
        50% {
            transform: translate(-15%, 10%);
        }
        60% {
            transform: translate(15%, 0%);
        }
        70% {
            transform: translate(0%, 15%);
        }
        80% {
            transform: translate(3%, 35%);
        }
        90% {
            transform: translate(-10%, 10%);
        }
    }
}

/* Base Styles */
@layer base {
    html {
        @apply scroll-smooth;
        background-color: var(--color-paper);
        color: var(--color-ink);
    }

    body {
        @apply font-body antialiased selection:bg-accent-indigo selection:text-white;
        overflow-x: hidden;

        /* Subtle Noise Overlay for Texture */
        &::after {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            right: -50%;
            bottom: -50%;
            width: 200%;
            height: 200vh;
            background: transparent
                url('http://assets.iceable.com/img/noise-transparent.png')
                repeat 0 0;
            background-repeat: repeat;
            animation: grain 8s steps(10) infinite;
            opacity: 0.03;
            z-index: 9999;
            pointer-events: none;
        }
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        @apply font-display tracking-tight text-ink;
    }
}

@layer components {
    /* Code Block Styling - Component Layer for Specificity */
    figure[data-rehype-pretty-code-figure] {
        @apply my-8 overflow-hidden rounded-xl border border-zinc-800 bg-black shadow-sm;

        /* Ensure code inside pre has consistent styling */
        pre {
            @apply overflow-x-auto py-4 text-sm leading-6 thin-scrollbar;
            background-color: transparent !important;
        }

        code {
            @apply grid min-w-full break-normal;
            font-family: var(--font-mono);
            counter-reset: line;
            box-decoration-break: clone;
        }

        /* Lines */
        [data-line] {
            @apply px-4 border-l-2 border-transparent block w-full;
            line-height: 1.5rem; /* Explicitly match leading-6 (24px) */
        }

        /* Line Numbers */
        code[data-line-numbers] {
            counter-reset: line;
        }

        code[data-line-numbers] > [data-line]::before {
            counter-increment: line;
            content: counter(line);
            @apply mr-6 w-4 text-right text-zinc-200 dark:text-zinc-200 inline-block text-xs;
            line-height: 1.5rem; /* Match parent line-height to prevent drift */
            height: 1.5rem;
            vertical-align: top; /* Ensure top alignment */
        }

        /* Highlighted Lines */
        [data-highlighted-line] {
            @apply bg-zinc-50 border-l-accent-indigo/50 dark:bg-zinc-800/50;
        }
    }

    /* New CodeBlock.astro shiki styles */
    .prose figure.code-block {
        @apply mt-6 mb-12 shadow-md rounded-md overflow-hidden border border-zinc-200/50 dark:border-zinc-800;
    }
    .prose .code-block pre {
        @apply rounded-none mt-0 px-0 bg-transparent py-0;
    }
    .prose .code-block code {
        @apply grid grid-flow-row font-mono bg-transparent! border-none! px-0! py-0! rounded-none!;
        font-family: 'JetBrains Mono', monospace;
    }
    .code-block .line {
        @apply px-4 border-l-2 border-transparent block w-full text-white;
    }

    /* Line Numbers */
    .code-block code[data-line-numbers] {
        counter-reset: line;
    }
    .code-block code[data-line-numbers] > .line::before {
        counter-increment: line;
        content: counter(line);
        @apply mr-4 inline-block w-4 text-right text-zinc-400 text-xs select-none;
    }

    .code-block .add {
        @apply bg-emerald-500/10 indent-0 border-l-0;
    }
    .code-block .remove {
        @apply bg-rose-500/10 indent-0 border-l-0;
    }
    .code-block .add span,
    .code-block .remove span {
        @apply opacity-100;
    }
}

/* Custom Scrollbar for Code Blocks */
@utility thin-scrollbar {
    scrollbar-width: thin;
    scrollbar-color: var(--color-ink-muted) transparent;

    &::-webkit-scrollbar {
        height: 6px;
        width: 6px;
    }

    &::-webkit-scrollbar-track {
        background: transparent;
    }

    &::-webkit-scrollbar-thumb {
        @apply bg-zinc-300 rounded-full dark:bg-zinc-700;
    }

    &::-webkit-scrollbar-thumb:hover {
        @apply bg-zinc-400 dark:bg-zinc-600;
    }
}

/* Utilities */
@utility glass {
    /* Sophisticated Glass - crisp edges, subtle depth */
    @apply backdrop-blur-xl border border-white/60 shadow-sm;
    background: linear-gradient(145deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);

    /* Inner highlight for "thick glass" feel */
    box-shadow:
        inset 0 1px 0 0 rgba(255, 255, 255, 0.9),
        0 4px 24px -12px rgba(0, 0, 0, 0.08);
}

@utility glass-card {
    /* Interactive Card Glass */
    @apply glass transition-all duration-500 ease-out;

    &:hover {
        @apply border-accent-indigo/20 shadow-[0_20px_40px_-12px_rgba(67,56,202,0.15)];
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%);
        transform: translateY(-4px);
    }
}

@utility text-balance {
    text-wrap: balance;
}

@utility text-glow-subtle {
    text-shadow: 0 0 20px rgba(67, 56, 202, 0.15);
}

@layer utilities {
    .hover-lift {
        @apply transition-transform duration-300 ease-out hover:-translate-y-1;
    }
}
